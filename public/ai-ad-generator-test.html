<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI ê´‘ê³  ìë™ ìƒì„± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    h1 { text-align: center; margin-bottom: 30px; color: #2c3e50; }
    .card { background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .row { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; }
    .col { flex: 1; min-width: 200px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
    input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #3498db; }
    button { background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; }
    button:hover { background: #2980b9; transform: translateY(-1px); }
    button:disabled { background: #bdc3c7; cursor: not-allowed; transform: none; }
    button.secondary { background: #95a5a6; }
    button.secondary:hover { background: #7f8c8d; }
    button.success { background: #27ae60; }
    button.success:hover { background: #229954; }
    .step-indicator { display: flex; justify-content: center; margin-bottom: 30px; }
    .step { display: flex; align-items: center; margin: 0 20px; }
    .step-number { width: 40px; height: 40px; border-radius: 50%; background: #e1e8ed; color: #7f8c8d; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; }
    .step-number.active { background: #3498db; color: white; }
    .step-number.completed { background: #27ae60; color: white; }
    .step-label { font-weight: 600; color: #2c3e50; }
    .preset-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-top: 16px; }
    .preset-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; }
    .preset-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    .preset-card.selected { border: 3px solid #f1c40f; }
    .preset-title { font-size: 18px; font-weight: bold; margin-bottom: 8px; }
    .preset-desc { font-size: 14px; opacity: 0.9; }
    .preset-colors { display: flex; gap: 8px; margin-top: 12px; }
    .color-dot { width: 20px; height: 20px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); }
    .result-section { margin-top: 20px; }
    .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .result-card { background: #f8f9fa; border-radius: 8px; padding: 16px; border-left: 4px solid #3498db; }
    .result-title { font-weight: bold; margin-bottom: 8px; color: #2c3e50; }
    .result-content { background: white; padding: 12px; border-radius: 6px; border: 1px solid #e1e8ed; }
    .image-preview { max-width: 100%; height: auto; border-radius: 8px; margin-top: 12px; }
    .loading { text-align: center; padding: 40px; color: #7f8c8d; }
    .error { background: #ffebee; color: #c62828; padding: 12px; border-radius: 6px; margin-top: 12px; border-left: 4px solid #f44336; }
    .success { background: #e8f5e8; color: #2e7d32; padding: 12px; border-radius: 6px; margin-top: 12px; border-left: 4px solid #4caf50; }
    .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
    .comparison-item { background: white; padding: 16px; border-radius: 8px; border: 1px solid #e1e8ed; }
    .comparison-label { font-weight: bold; margin-bottom: 8px; color: #2c3e50; }
    .download-btn { background: #27ae60; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-top: 8px; }
    .download-btn:hover { background: #229954; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ AI ê´‘ê³  ìë™ ìƒì„± ì‹œìŠ¤í…œ</h1>
    
    <!-- ë‹¨ê³„ë³„ ì§„í–‰ í‘œì‹œ -->
    <div class="step-indicator">
      <div class="step">
        <div class="step-number active" id="step1">1</div>
        <div class="step-label">ì´ë¯¸ì§€ ì—…ë¡œë“œ & ë¶„ì„</div>
      </div>
      <div class="step">
        <div class="step-number" id="step2">2</div>
        <div class="step-label">ê´‘ê³  ëª©ì  ì„ íƒ</div>
      </div>
      <div class="step">
        <div class="step-number" id="step3">3</div>
        <div class="step-label">AI ê´‘ê³  ìƒì„±</div>
      </div>
    </div>

    <!-- 1ë‹¨ê³„: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ -->
    <div class="card">
      <h3>ğŸ“¸ 1ë‹¨ê³„: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° AI ë¶„ì„</h3>
      <div class="row">
        <div class="col">
          <label>ì´ë¯¸ì§€ íŒŒì¼</label>
          <input type="file" id="imageFile" accept="image/*" />
        </div>
        <div class="col">
          <label>ì„œë²„ ì£¼ì†Œ</label>
          <input id="serverUrl" value="http://localhost:3000" />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button id="btnAnalyze" class="success">ğŸ” AI ì´ë¯¸ì§€ ë¶„ì„ ì‹œì‘</button>
        </div>
      </div>
      
      <!-- ë¶„ì„ ê²°ê³¼ í‘œì‹œ -->
      <div id="analysisResult" style="display: none;">
        <div class="result-section">
          <h4>ğŸ“Š AI ë¶„ì„ ê²°ê³¼</h4>
          <div class="result-grid">
            <div class="result-card">
              <div class="result-title">ì£¼ìš” í”¼ì‚¬ì²´</div>
              <div class="result-content" id="mainSubject">-</div>
            </div>
            <div class="result-card">
              <div class="result-title">ì‹œê°ì  ìŠ¤íƒ€ì¼</div>
              <div class="result-content" id="visualStyle">-</div>
            </div>
            <div class="result-card">
              <div class="result-title">ìƒ‰ìƒ íŒ”ë ˆíŠ¸</div>
              <div class="result-content" id="colorPalette">-</div>
            </div>
            <div class="result-card">
              <div class="result-title">ë¶„ìœ„ê¸°</div>
              <div class="result-content" id="moodAtmosphere">-</div>
            </div>
          </div>
          
          <div class="result-section">
            <h4>ğŸ’¡ AI ì¶”ì²œì‚¬í•­</h4>
            <div class="result-grid">
              <div class="result-card">
                <div class="result-title">ì¶”ì²œ ê´‘ê³  ëª©ì </div>
                <div class="result-content" id="recommendedPurposes">-</div>
              </div>
              <div class="result-card">
                <div class="result-title">ë””ìì¸ íŒ</div>
                <div class="result-content" id="designTips">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 2ë‹¨ê³„: ê´‘ê³  ëª©ì  ì„ íƒ -->
    <div class="card" id="purposeSelectionCard" style="display: none;">
      <h3>ğŸ¯ 2ë‹¨ê³„: ê´‘ê³  ëª©ì  ì„ íƒ</h3>
      <div class="row">
        <div class="col">
          <label>ë¸Œëœë“œëª… *</label>
          <input id="brandName" placeholder="My Brand" />
        </div>
        <div class="col">
          <label>ì£¼ìš” ìƒí’ˆ/ì„œë¹„ìŠ¤ *</label>
          <input id="mainProduct" placeholder="í•µì‹¬ ì œí’ˆëª…" />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>í˜„ì¬ ìŠ¬ë¡œê±´</label>
          <input id="slogan" placeholder="ê¸°ì¡´ ìŠ¬ë¡œê±´ (ì„ íƒì‚¬í•­)" />
          <small style="color: #666; font-size: 12px;">ğŸ’¡ ìŠ¬ë¡œê±´ì„ ì…ë ¥í•˜ë©´ AIê°€ ë” ë§¤ë ¥ì ìœ¼ë¡œ ê°œì„ í•©ë‹ˆë‹¤. ë¹„ì›Œë‘ë©´ AIê°€ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.</small>
        </div>
        <div class="col">
          <label>ì—°ë½ì²˜ ì •ë³´</label>
          <input id="contactInfo" placeholder="ì „í™”ë²ˆí˜¸, ì›¹ì‚¬ì´íŠ¸ ë“±" />
        </div>
      </div>
      
      <div class="row">
        <div class="col">
          <button id="btnLoadPurposes">ğŸ“‹ ê´‘ê³  ëª©ì  í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
      </div>
      
      <!-- ê´‘ê³  ëª©ì  í”„ë¦¬ì…‹ í‘œì‹œ -->
      <div id="purposePresets" class="preset-grid" style="display: none;"></div>
      
      <div class="row" style="margin-top: 20px;">
        <div class="col">
          <div class="muted">ì„ íƒëœ ê´‘ê³  ëª©ì : <span id="selectedPurpose">-</span></div>
        </div>
      </div>
    </div>

    <!-- 3ë‹¨ê³„: AI ê´‘ê³  ìƒì„± -->
    <div class="card" id="generationCard" style="display: none;">
      <h3>ğŸš€ 3ë‹¨ê³„: AI ê´‘ê³  ìƒì„±</h3>
      <div class="row">
        <div class="col">
          <button id="btnGenerateAd" class="success">ğŸ¨ AI ê´‘ê³  ìƒì„± ì‹œì‘</button>
        </div>
      </div>
      
      <!-- ìƒì„± ê²°ê³¼ í‘œì‹œ -->
      <div id="generationResult" style="display: none;">
        <div class="result-section">
          <h4>âœ¨ AI ìƒì„± ê²°ê³¼</h4>
          
          <!-- ìµœì í™”ëœ í…ìŠ¤íŠ¸ -->
          <div class="result-section">
            <h5>ğŸ“ ìµœì í™”ëœ í…ìŠ¤íŠ¸</h5>
            <div class="comparison">
              <div class="comparison-item">
                <div class="comparison-label">ì›ë³¸</div>
                <div id="originalText">-</div>
              </div>
              <div class="comparison-item">
                <div class="comparison-label">AI ìµœì í™”</div>
                <div id="optimizedText">-</div>
              </div>
            </div>
          </div>
          
          <!-- Sharp.js í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ í¬ìŠ¤í„° -->
          <div class="result-section">
            <h5>ğŸ¨ Sharp.js í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ í¬ìŠ¤í„°</h5>
            <div class="result-card">
              <div class="result-title">âœ¨ Sharp.jsë¡œ ì›ë³¸ ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ í¬ìŠ¤í„°</div>
              <div class="result-content">
                <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 16px;">
                  <p><strong>ğŸ¯ ì›ë³¸ ì´ë¯¸ì§€ 100% ìœ ì§€ + ì „ë¬¸ì ì¸ í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´</strong></p>
                  <p>ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì‚¬ì§„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ì •í™•í•œ ìœ„ì¹˜ì— ë°°ì¹˜</p>
                  <p>íˆ¬ëª…í•œ ì•„í¬ë¦´ ì œí’ˆ â†’ íˆ¬ëª…í•œ ì•„í¬ë¦´ ì œí’ˆ + í…ìŠ¤íŠ¸ë¡œ ì™„ì„±</p>
                </div>
                <img id="sharpGeneratedPoster" class="image-preview" style="margin-top: 16px; display:none;" />
              </div>
              <button id="btnDownloadAd" class="download-btn">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
            </div>
          </div>
          
          <!-- ìƒì„± ìš”ì•½ -->
          <div class="result-section">
            <h5>ğŸ“Š ìƒì„± ìš”ì•½</h5>
            <div class="result-grid">
              <div class="result-card">
                <div class="result-title">ê´‘ê³  ëª©ì </div>
                <div class="result-content" id="summaryPurpose">-</div>
              </div>
              <div class="result-card">
                <div class="result-title">ë””ìì¸ ìŠ¤íƒ€ì¼</div>
                <div class="result-content" id="summaryStyle">-</div>
              </div>
              <div class="result-card">
                <div class="result-title">íƒ€ê²Ÿ ê°ì •</div>
                <div class="result-content" id="summaryEmotion">-</div>
              </div>
              <div class="result-card">
                <div class="result-title">ìƒì„± ì‹œê°„</div>
                <div class="result-content" id="summaryTime">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    let selectedPurpose = null;
    let imageAnalysis = null;
    let generationStartTime = null;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ìë™ ê°ì§€
    document.addEventListener('DOMContentLoaded', async () => {
      try { 
        $('serverUrl').value = location.origin; 
      } catch {}
      
      // ì„œë²„ ìë™ ê°ì§€
      const portsToTry = [location.port, '3000', '4000', '8080'];
      for (const port of portsToTry) {
        if (!port) continue;
        const testUrl = `${location.protocol}//${location.hostname}:${port}`;
        try {
          const response = await fetch(`${testUrl}/health`);
          if (response.ok) {
            $('serverUrl').value = testUrl;
            console.log(`Server detected at: ${testUrl}`);
            break;
          }
        } catch (e) {
          // console.warn(`Health check failed for ${testUrl}:`, e);
        }
      }
    });

    // 1ë‹¨ê³„: ì´ë¯¸ì§€ ë¶„ì„
    $('btnAnalyze').onclick = async () => {
      const file = $('imageFile').files[0];
      if (!file) {
        alert('ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      $('btnAnalyze').disabled = true;
      $('btnAnalyze').textContent = 'ë¶„ì„ ì¤‘...';

      try {
        const formData = new FormData();
        formData.append('image', file);

        const response = await fetch(`${$('serverUrl').value}/api/ad-generation/analyze-image`, {
          method: 'POST',
          body: formData
        });

        const data = await response.json();
        
        if (data.success) {
          imageAnalysis = data.analysis;
          displayAnalysisResult(data);
          showStep(2);
          $('purposeSelectionCard').style.display = 'block';
        } else {
          throw new Error(data.message || 'ë¶„ì„ ì‹¤íŒ¨');
        }
      } catch (error) {
        showError('ì´ë¯¸ì§€ ë¶„ì„ ì‹¤íŒ¨: ' + error.message);
      } finally {
        $('btnAnalyze').disabled = false;
        $('btnAnalyze').textContent = 'ğŸ” AI ì´ë¯¸ì§€ ë¶„ì„ ì‹œì‘';
      }
    };

    // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
    function displayAnalysisResult(data) {
      const { analysis, suggestions } = data;
      
      $('mainSubject').textContent = analysis.main_subject || '-';
      $('visualStyle').textContent = analysis.visual_style || '-';
      $('colorPalette').textContent = analysis.color_palette?.join(', ') || '-';
      $('moodAtmosphere').textContent = analysis.mood_atmosphere || '-';
      
      $('recommendedPurposes').textContent = suggestions.recommended_purposes?.join(', ') || '-';
      $('designTips').innerHTML = suggestions.design_tips?.map(tip => `â€¢ ${tip}`).join('<br>') || '-';
      
      $('analysisResult').style.display = 'block';
    }

    // 2ë‹¨ê³„: ê´‘ê³  ëª©ì  í”„ë¦¬ì…‹ ë¡œë“œ
    $('btnLoadPurposes').onclick = async () => {
      $('btnLoadPurposes').disabled = true;
      $('btnLoadPurposes').textContent = 'ë¡œë”© ì¤‘...';

      try {
        const response = await fetch(`${$('serverUrl').value}/api/ad-generation/purpose-presets`);
        const data = await response.json();
        
        if (data.success) {
          displayPurposePresets(data.presets);
        } else {
          throw new Error(data.message || 'í”„ë¦¬ì…‹ ë¡œë“œ ì‹¤íŒ¨');
        }
      } catch (error) {
        showError('í”„ë¦¬ì…‹ ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
      } finally {
        $('btnLoadPurposes').disabled = false;
        $('btnLoadPurposes').textContent = 'ğŸ“‹ ê´‘ê³  ëª©ì  í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°';
      }
    };

    // ê´‘ê³  ëª©ì  í”„ë¦¬ì…‹ í‘œì‹œ
    function displayPurposePresets(presets) {
      const container = $('purposePresets');
      container.innerHTML = '';
      
      presets.forEach(preset => {
        const card = document.createElement('div');
        card.className = 'preset-card';
        card.onclick = () => selectPurpose(preset);
        
        card.innerHTML = `
          <div class="preset-title">${preset.label}</div>
          <div class="preset-desc">${preset.description}</div>
          <div class="preset-colors">
            ${preset.colors.map(color => `<div class="color-dot" style="background: ${color}"></div>`).join('')}
          </div>
        `;
        
        container.appendChild(card);
      });
      
      container.style.display = 'grid';
    };

    // ê´‘ê³  ëª©ì  ì„ íƒ
    function selectPurpose(preset) {
      selectedPurpose = preset;
      
      // ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.preset-card').forEach(card => {
        card.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');
      
      $('selectedPurpose').textContent = preset.label;
      
      // 3ë‹¨ê³„ í‘œì‹œ
      showStep(3);
      $('generationCard').style.display = 'block';
    };

    // 3ë‹¨ê³„: AI ê´‘ê³  ìƒì„±
    $('btnGenerateAd').onclick = async () => {
      if (!selectedPurpose) {
        alert('ê´‘ê³  ëª©ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      // ğŸš« ì‚¬ìš©ì ì…ë ¥ ì ˆëŒ€ ê²€ì¦
      const brandName = $('brandName').value.trim();
      const mainProduct = $('mainProduct').value.trim();
      const slogan = $('slogan').value.trim();
      const contactInfo = $('contactInfo').value.trim();

      // í•„ìˆ˜ ì…ë ¥ ê²€ì¦
      if (!brandName) {
        alert('ğŸš« ë¸Œëœë“œëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤!');
        $('brandName').focus();
        return;
      }
      if (!mainProduct) {
        alert('ğŸš« ì£¼ìš” ìƒí’ˆ/ì„œë¹„ìŠ¤ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤!');
        $('mainProduct').focus();
        return;
      }

      const userInputs = {
        brand_name: brandName,
        main_product: mainProduct,
        slogan: slogan,
        contact_info: contactInfo
      };

      // ğŸš« ì‚¬ìš©ì ì…ë ¥ ì ˆëŒ€ í™•ì¸ (AI ì„ì˜ ìƒì„± ê¸ˆì§€)
      const confirmMessage = `ğŸš« AI ì„ì˜ ìƒì„± ê¸ˆì§€ í™•ì¸!\n\nì…ë ¥ëœ ì •ë³´:\në¸Œëœë“œ: "${brandName}"\nìƒí’ˆ: "${mainProduct}"\nìŠ¬ë¡œê±´: "${slogan || 'ì—†ìŒ'}"\n\nì´ ì •ë³´ë¡œ ì •í™•íˆ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
      
      if (!confirm(confirmMessage)) {
        alert('ì‚¬ìš©ì ì…ë ¥ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }

      console.log('ğŸš« ì‚¬ìš©ì ì…ë ¥ ì ˆëŒ€ í™•ì¸:', userInputs);

      $('btnGenerateAd').disabled = true;
      $('btnGenerateAd').textContent = 'ìƒì„± ì¤‘...';
      generationStartTime = new Date();

      try {
        const formData = new FormData();
        formData.append('image', $('imageFile').files[0]);
        formData.append('ad_purpose', selectedPurpose.key);
        formData.append('user_inputs', JSON.stringify(userInputs));
        // ê¸°ë³¸ê°’: blur ë¹„í™œì„±, gradient ë¹„í™œì„± (ì‚¬ì§„ ì‹ë³„ì„± ìœ ì§€)
        formData.append('effects', JSON.stringify({ blur: false, gradient: false }));

        const response = await fetch(`${$('serverUrl').value}/api/ad-generation/generate-complete`, {
          method: 'POST',
          body: formData
        });

        const data = await response.json();
        
        if (data.success) {
          displayGenerationResult(data);
        } else {
          throw new Error(data.message || 'ê´‘ê³  ìƒì„± ì‹¤íŒ¨');
        }
      } catch (error) {
        showError('ê´‘ê³  ìƒì„± ì‹¤íŒ¨: ' + error.message);
      } finally {
        $('btnGenerateAd').disabled = false;
        $('btnGenerateAd').textContent = 'ğŸ¨ AI ê´‘ê³  ìƒì„± ì‹œì‘';
      }
    };

    // ìƒì„± ê²°ê³¼ í‘œì‹œ
    function displayGenerationResult(data) {
      const { result, summary } = data;
      
      // ğŸš« ì‚¬ìš©ì ì…ë ¥ ì ˆëŒ€ ë³´ì¡´ í™•ì¸
      $('originalText').innerHTML = `
        <strong>ë¸Œëœë“œ:</strong> ${result.optimized_text.optimized_brand}<br>
        <strong>ìƒí’ˆ:</strong> ${result.optimized_text.main_product || 'ì‚¬ìš©ì ì…ë ¥'}<br>
        <strong>ìŠ¬ë¡œê±´:</strong> ${result.optimized_text.optimized_slogan}
      `;
      
      // âœ… ìŠ¬ë¡œê±´ AI ê°œì„  ê²°ê³¼ í‘œì‹œ
      const sloganStatus = result.optimized_text.optimized_slogan ? 'âœ… AI ê°œì„ ë¨' : 'âŒ ìƒì„± ì‹¤íŒ¨';
      
      $('optimizedText').innerHTML = `
        <strong>ë¸Œëœë“œ:</strong> ${result.optimized_text.optimized_brand}<br>
        <strong>ìƒí’ˆ:</strong> ${result.optimized_text.main_product || 'ì‚¬ìš©ì ì…ë ¥'}<br>
        <strong>ìŠ¬ë¡œê±´:</strong> ${result.optimized_text.optimized_slogan} <span style="color: #27ae60; font-size: 12px;">${sloganStatus}</span><br>
        <strong>í–‰ë™ ìœ ë„:</strong> ${result.optimized_text.call_to_action}<br>
        <strong>ê°ì •ì  í›…:</strong> ${result.optimized_text.emotional_hook}
      `;
      
      // ğŸ¨ Sharp.jsê°€ ìƒì„±í•œ í¬ìŠ¤í„° ì´ë¯¸ì§€ í‘œì‹œ
      const sharpGeneratedPosterElement = $('sharpGeneratedPoster');
      if (result.poster_url) {
        sharpGeneratedPosterElement.src = result.poster_url;
        sharpGeneratedPosterElement.style.display = 'block';
        console.log('ğŸ¨ Sharp.js í¬ìŠ¤í„° ì´ë¯¸ì§€ í‘œì‹œ:', result.poster_url);
      } else {
        console.error('âŒ Sharp.js í¬ìŠ¤í„° ì´ë¯¸ì§€ URL ì—†ìŒ');
        sharpGeneratedPosterElement.style.display = 'none';
      }
      
      // ğŸ“Š ìƒì„± ìš”ì•½ ì •ë³´ í‘œì‹œ
      if (result.design && result.design.metadata) {
        $('summaryPurpose').textContent = result.ad_purpose || '-';
        $('summaryStyle').textContent = result.design.metadata.style || '-';
        $('summaryEmotion').textContent = result.design.metadata.emotion || '-';
      }
      
      if (generationStartTime) {
        const endTime = new Date();
        const duration = Math.round((endTime - generationStartTime) / 1000);
        $('summaryTime').textContent = `${duration}ì´ˆ`;
      }
      
      // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
      $('generationResult').style.display = 'block';
      $('generationResult').scrollIntoView({ behavior: 'smooth' });
    }

    // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
    $('btnDownloadAd').onclick = () => {
      const sharpGeneratedPosterElement = $('sharpGeneratedPoster');
      
      if (sharpGeneratedPosterElement && sharpGeneratedPosterElement.src && sharpGeneratedPosterElement.src.startsWith('http')) {
        // Sharp.js í¬ìŠ¤í„° ì´ë¯¸ì§€ URLì„ ë‹¤ìš´ë¡œë“œ
        const imageUrl = sharpGeneratedPosterElement.src;
        const imageName = `sharp-poster-${Date.now()}.png`;
        const link = document.createElement('a');
        link.href = imageUrl;
        link.download = imageName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else if (sharpGeneratedPosterElement && sharpGeneratedPosterElement.src && sharpGeneratedPosterElement.src.startsWith('data:')) {
        // Base64 ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        const link = document.createElement('a');
        link.href = sharpGeneratedPosterElement.src;
        link.download = `sharp-poster-${Date.now()}.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        alert('ë‹¤ìš´ë¡œë“œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }
    };

    // ë‹¨ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
    function showStep(stepNumber) {
      for (let i = 1; i <= 3; i++) {
        const stepElement = $(`step${i}`);
        if (i < stepNumber) {
          stepElement.className = 'step-number completed';
        } else if (i === stepNumber) {
          stepElement.className = 'step-number active';
        } else {
          stepElement.className = 'step-number';
        }
      }
    }

    // ì—ëŸ¬ í‘œì‹œ
    function showError(message) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error';
      errorDiv.textContent = message;
      
      // ê¸°ì¡´ ì—ëŸ¬ ì œê±°
      document.querySelectorAll('.error').forEach(el => el.remove());
      
      // ìƒˆ ì—ëŸ¬ ì¶”ê°€
      document.querySelector('.container').appendChild(errorDiv);
      
      // 3ì´ˆ í›„ ìë™ ì œê±°
      setTimeout(() => errorDiv.remove(), 3000);
    }
  </script>
</body>
</html>

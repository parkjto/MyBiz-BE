<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyBiz-BE Naver Integration Tester</title>
  <style>
    :root { --bg:#0e1116; --panel:#161b22; --text:#e6edf3; --muted:#9da7b1; --accent:#2f81f7; }
    * { box-sizing:border-box; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, Apple Color Emoji, Segoe UI Emoji; }
    header { padding:16px 20px; border-bottom:1px solid #222; display:flex; align-items:center; gap:12px; }
    header h1 { margin:0; font-size:18px; font-weight:600; }
    main { max-width:960px; margin:0 auto; padding:20px; display:grid; grid-template-columns: 1fr; gap:16px; }
    .grid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:16px; }
    .panel { background:var(--panel); border:1px solid #222; border-radius:10px; padding:16px; }
    .panel h2 { margin:0 0 12px 0; font-size:16px; }
    label { display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input, textarea, select { width:100%; padding:10px 12px; background:#0b0f14; color:var(--text); border:1px solid #2a2f36; border-radius:8px; outline:none; }
    input:focus, textarea:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgb(47 129 247 / 20%); }
    .row { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:12px; }
    .btns { display:flex; flex-wrap:wrap; gap:8px; }
    button { cursor:pointer; background:var(--accent); color:white; border:none; padding:10px 12px; border-radius:8px; font-weight:600; }
    button.secondary { background:#30363d; }
    button.danger { background:#d14343; }
    pre { margin:0; white-space:pre-wrap; word-break:break-word; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; color:#c9d1d9; }
    .muted { color:var(--muted); font-size:12px; }
  </style>
</head>
<body>
  <header>
    <h1>네이버 연동 테스트 (MyBiz-BE)</h1>
    <span class="muted">setup / test / status / delete 엔드포인트 검증</span>
  </header>
  <main>
    <section class="panel">
      <h2>환경 설정</h2>
      <div class="grid">
        <div>
          <label for="baseUrl">Base URL</label>
          <input id="baseUrl" type="text" placeholder="예: http://localhost:4000" />
        </div>
        <div>
          <label for="token">Authorization Bearer Token</label>
          <input id="token" type="text" placeholder="로그인 후 받은 JWT 토큰" />
        </div>
      </div>
      <div class="btns" style="margin-top:10px;">
        <button class="secondary" onclick="persist()">설정 저장</button>
        <button class="secondary" onclick="loadPersisted()">설정 불러오기</button>
      </div>
    </section>

    <section class="panel">
      <h2>파라미터</h2>
      <div class="grid">
        <div>
          <label for="userStoreId">userStoreId (UUID)</label>
          <input id="userStoreId" type="text" placeholder="스토어 UUID" />
        </div>
        <div></div>
      </div>
      <div class="row" style="margin-top:12px;">
        <div>
          <label for="username">네이버 아이디</label>
          <input id="username" type="text" placeholder="naver id" />
        </div>
        <div>
          <label for="password">네이버 비밀번호</label>
          <input id="password" type="password" placeholder="password" />
        </div>
      </div>
    </section>

    <section class="panel">
      <h2>동작</h2>
      <div class="btns">
        <button onclick="setup()">1) 연동 설정 (POST /api/naver-credentials/setup)</button>
        <button onclick="testConn()">2) 연결 테스트 (POST /api/naver-credentials/test/:id)</button>
        <button class="secondary" onclick="getStatus()">3) 상태 조회 (GET /api/naver-credentials/status/:id)</button>
        <button class="danger" onclick="removeIntegration()">4) 연동 해제 (DELETE /api/naver-credentials/:id)</button>
      </div>
    </section>

    <section class="panel">
      <h2>응답</h2>
      <pre id="out">ready.</pre>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    function persist() {
      const data = {
        baseUrl: $("baseUrl").value.trim(),
        token: $("token").value.trim(),
        userStoreId: $("userStoreId").value.trim(),
        username: $("username").value.trim()
      };
      localStorage.setItem("naverTester", JSON.stringify(data));
      log({ message: "설정 저장 완료", data });
    }
    function loadPersisted() {
      const raw = localStorage.getItem("naverTester");
      if (!raw) return log({ message: "저장된 설정이 없습니다" });
      try {
        const data = JSON.parse(raw);
        if (data.baseUrl) $("baseUrl").value = data.baseUrl;
        if (data.token) $("token").value = data.token;
        if (data.userStoreId) $("userStoreId").value = data.userStoreId;
        if (data.username) $("username").value = data.username;
        log({ message: "설정 불러오기 완료", data });
      } catch (e) {
        log(e);
      }
    }
    function headers() {
      const t = $("token").value.trim();
      const h = { "Content-Type": "application/json" };
      if (t) h["Authorization"] = `Bearer ${t}`;
      return h;
    }
    function log(obj) {
      $("out").textContent = JSON.stringify(obj, null, 2);
    }
    function base() {
      let b = $("baseUrl").value.trim();
      if (!b) b = location.origin;
      return b.replace(/\/$/, "");
    }

    async function setup() {
      try {
        const url = base() + "/api/naver-credentials/setup";
        const body = {
          userStoreId: $("userStoreId").value.trim(),
          username: $("username").value.trim(),
          password: $("password").value
        };
        const res = await fetch(url, { method: "POST", headers: headers(), body: JSON.stringify(body) });
        const json = await res.json();
        log({ status: res.status, json });
      } catch (e) { log({ error: e.message }); }
    }

    async function testConn() {
      try {
        const id = $("userStoreId").value.trim();
        const url = base() + `/api/naver-credentials/test/${id}`;
        const res = await fetch(url, { method: "POST", headers: headers() });
        const json = await res.json();
        log({ status: res.status, json });
      } catch (e) { log({ error: e.message }); }
    }

    async function getStatus() {
      try {
        const id = $("userStoreId").value.trim();
        const url = base() + `/api/naver-credentials/status/${id}`;
        const res = await fetch(url, { method: "GET", headers: headers() });
        const json = await res.json();
        log({ status: res.status, json });
      } catch (e) { log({ error: e.message }); }
    }

    async function removeIntegration() {
      try {
        const id = $("userStoreId").value.trim();
        const url = base() + `/api/naver-credentials/${id}`;
        const res = await fetch(url, { method: "DELETE", headers: headers() });
        const json = await res.json();
        log({ status: res.status, json });
      } catch (e) { log({ error: e.message }); }
    }

    // 초기화
    loadPersisted();
  </script>
</body>
</html>
